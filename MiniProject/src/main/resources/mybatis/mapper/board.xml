<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team.proj.board.dao.BoardDAO">


    <!-- 글 한개만 가져오기 -->
    <select id="getBoard" parameterType="int" resultType="com.team.proj.board.dto.BoardDTO">
		SELECT
		    b.order_no,
		    b.request_date,
		    b.order_title,
		    b.order_content,
		    a.mem_id,
		    b.calc_id,
		    a.entp_name,
		    b.calc_result,
		    b.request_date,
		    b.feedback_yn,
		    b.del_yn
		FROM BOARDS b, MEMBERS a
		WHERE b.mem_id = a.mem_id(+)
		AND b.order_no = #{orderNo}
    </select>

    <!-- 글쓰기 (INSERT) -->
    <insert id="insertBoard"
        parameterType="com.team.proj.board.dto.BoardDTO">
        INSERT INTO order_board (request_date, order_title,
        order_content,
        mem_id, feedback_yn)
        VALUES (#{requestDate},
        #{orderTitle}, #{orderContent}, #{memId},
        #{feedbackYn})
    </insert>

    <!-- 글 수정 (UPDATE) -->
    <update id="updateBoard"
        parameterType="com.team.proj.board.dto.BoardDTO">
        UPDATE order_board
        SET order_title = #{orderTitle}, order_content = #{orderContent}
        WHERE order_no = #{orderNo}
    </update>

    <!-- 글 삭제 (UPDATE) -->
    <update id="deleteBoard" parameterType="int">
        UPDATE order_board
        SET del_yn = 'Y'
        WHERE order_no = #{no}
    </update>
    
    
    
    
    
    <!-- 게시글 작성 -->
    <insert id="boardWriteDo" parameterType="com.team.proj.board.dto.BoardDTO">
		INSERT INTO BOARDS(
			board_id,
		    order_no,      
		    mem_id,       
		    calc_id,       
		    calc_result,       
		    order_title,    
		    order_content,    
		    request_date,  
		    feedback_yn,
		    del_yn,
		    entp_name
		)VALUES(
			#{boardId},
		    seq_board.nextval,
		    #{memId},
		    #{calcId},
		    #{calcResult},
		    #{orderTitle},
		    #{orderContent},
		    SYSDATE,
		    'N',
		    'N',
		    #{entpName}
		)
    </insert>

	<!-- 회원아이디로 게시글 불러오기 -->
	<select id="getBoardListById" parameterType="String" resultType="com.team.proj.board.dto.BoardDTO">
		SELECT
			board_id,
			order_no,      
		    mem_id,       
		    calc_id,       
		    calc_result,       
		    order_title,    
		    order_content,    
		    TO_CHAR(request_date, 'YYYY-MM-DD HH24:MI') AS request_date ,  
		    feedback_yn,
		    del_yn,
		    entp_name
		FROM BOARDS
		WHERE 1=1
		<if test="memId != 'admin'">
		  AND MEM_ID = #{memId}
		</if>
		ORDER BY ORDER_NO DESC
	</select>
	
	<select id="getBoardListByIdConfirm" parameterType="com.team.proj.board.dto.BoardDTO" resultType="com.team.proj.board.dto.BoardDTO">
		SELECT
			board_id,
			order_no,      
		    mem_id,       
		    calc_id,       
		    calc_result,       
		    order_title,    
		    order_content,    
		    TO_CHAR(request_date, 'YYYY-MM-DD HH24:MI') AS request_date ,  
		    feedback_yn,
		    del_yn,
		    entp_name
		FROM BOARDS
		WHERE 1=1
		<if test="feedbackYn != null">
			AND feedback_yn = #{feedbackYn}
		</if>
		ORDER BY ORDER_NO DESC
	</select>
	
</mapper>
